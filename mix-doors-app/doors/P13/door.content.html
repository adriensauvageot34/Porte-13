<div class="door">
  <div class="door-title">
    <h1>üß≠ PORTE P13 ‚Äî Espace (reverb / delay / profondeur)</h1>
    <p class="muted">P13 = mise en sc√®ne : reverb/delay positionnent et hi√©rarchisent. Objectif : profondeur lisible sans voler le message.</p>
  </div>

  <!-- 0) STATE -->
  <section class="card" data-section-id="state">
    <header>
      <div class="h">
        <span class="tag">0) [STATE]</span>
        <span>Bandeau d‚Äô√©tat</span>
      </div>
      <div class="sub">Status / Toggles / checkpoint / risques / liens rapides</div>
    </header>

    <div class="body">
      <table>
        <tr><th style="width:220px;">Champ</th><th>Valeur</th></tr>

        <tr>
          <td><b>Status</b></td>
          <td>
            <label class="opt"><input type="radio" name="p13_status" data-bind="status" value="ACTIVE"> ACTIVE</label>
            <label class="opt"><input type="radio" name="p13_status" data-bind="status" value="DONE"> DONE</label>
            <label class="opt"><input type="radio" name="p13_status" data-bind="status" value="NEEDS_RETEST"> NEEDS_RETEST</label>
            <label class="opt"><input type="radio" name="p13_status" data-bind="status" value="RISK"> RISK</label>
          </td>
        </tr>

        <tr>
          <td><b>Toggles</b></td>
          <td>
            <label class="opt"><input type="checkbox" data-bind="toggles.sigOff"> <span class="tag">[TOGGLE:SIG_OFF]</span></label>
            <label class="opt"><input type="checkbox" data-bind="toggles.ctrlOff"> <span class="tag">[TOGGLE:CTRL_OFF]</span></label>
          </td>
        </tr>

        <tr>
          <td><b>Checkpoint actuel</b></td>
          <td class="muted">
            <a href="#" data-open-resource="p13-checkpoints">[CHECKPOINT:PH2_LOCKED] / [CHECKPOINT:PH3_LOCKED]</a>
          </td>
        </tr>

        <tr>
          <td><b>RISK_BADGE</b></td>
          <td><input class="fill" placeholder="ex: FX sujet / nuage / mono fragile / groove cass√©" data-bind="state.riskBadge"></td>
        </tr>

        <tr>
          <td><b>DEPENDS / REOPENS</b></td>
          <td class="muted">
            ‚ö† <a href="#" data-open-resource="p13-depends">[DEPENDS_ON:P11]</a>
            ‚ö† <a href="#" data-open-resource="p13-depends">[DEPENDS_ON:P8]</a>
            ‚ö† <a href="#" data-open-resource="p13-depends">[DEPENDS_ON:P10]</a>
            / ‚ö† <a href="#" data-open-resource="p13-depends">[REOPENS:P13]</a>
          </td>
        </tr>
      </table>
    </div>
  </section>

  <!-- 1) PATH -->
  <section class="card" data-section-id="path">
    <header>
      <div class="h">
        <span class="tag">1) PATH</span>
        <span>PATH PICKER ‚Äî TRIAL ‚Üí COMMIT</span>
      </div>
      <div class="sub">TRIAL max 2 / COMMIT 1 obligatoire</div>
    </header>

    <div class="body">
      <div data-mount="path-picker"></div>

      <div class="hr"></div>
      <div class="muted">
        <b>R√®gles (factuelles)</b>
        <ul>
          <li>TRIAL : maximum 2 chemins coch√©s.</li>
          <li>COMMIT : 1 seul chemin coch√© (obligatoire).</li>
          <li>Si COMMIT non coch√© ‚Üí porte ‚â† DONE.</li>
          <li>Apr√®s COMMIT : pas de changement de chemin sans FAIL prouv√© + trigger not√©. <span class="ref">[REF:R3-07]</span></li>
        </ul>
      </div>
    </div>
  </section>

  <!-- 1bis) TARGET -->
  <section class="card" data-section-id="target">
    <header>
      <div class="h">
        <span class="tag">1bis) TARGET</span>
        <span>TARGET PICKER ‚Äî SCOPE</span>
      </div>
      <div class="sub">PRIMARY 1 obligatoire / SECONDARY 0‚Äì2</div>
    </header>

    <div class="body">
      <div data-mount="target-picker"></div>

      <div class="hr"></div>
      <div class="muted">
        <b>R√®gles</b>
        <ul>
          <li>PRIMARY : 1 seul r√¥le coch√© (obligatoire). Par d√©faut : PRIMARY = RETURNS.</li>
          <li>SECONDARY : 0‚Äì2 max.</li>
          <li>Si aucun PRIMARY ‚Üí porte ‚â† DONE.</li>
        </ul>
      </div>
    </div>
  </section>

  <!-- CORE -->
  <section class="card" data-section-id="core">
    <header>
      <div class="h">
        <span class="tag">[CORE]</span>
        <span>Ex√©cution</span>
      </div>
      <div class="sub">D√©cider un monde, prouver, puis geler.</div>
    </header>

    <div class="body">
      <ul>
        <li><b>Objectif</b> : mettre en sc√®ne la voix (plan + hi√©rarchie), pas d√©corer.</li>
        <li><b>Grande question</b> : l‚Äôespace prend-il la place du message (lead recule, diction floue, plans illisibles) ?</li>
        <li><b>Contrat garanti</b> : si PASS, la lead reste devant, les couches restent derri√®re, et l‚Äôespace se ressent sans attirer l‚Äôattention. <span class="ref">[REF:R3-04]</span></li>
        <li><b>D√©cision principale</b> : choisir un seul monde par section, puis doser via SEND/RETURN (pas ‚Äúau hasard‚Äù partout).</li>
        <li><b>Sortie attendue</b> : profondeur lisible (centre sacr√©), coh√©rence par section, throws choisis, groove intact. <span class="ref">[REF:R3-16]</span></li>
        <li><b>Interdits</b> : juger ‚Äúmieux‚Äù parce que plus fort, empiler 5 espaces, utiliser la reverb pour ‚Äúfaire exister‚Äù la voix. <span class="ref">[REF:R3-03]</span></li>
        <li><b>LISTEN</b> : <span class="tag">[LISTEN:Plan]</span> <span class="tag">[LISTEN:Diction]</span> <span class="tag">[LISTEN:Groove]</span></li>
        <li><b>Preuve</b> : A/B level-match (bypass) + A/B <span class="tag">[TOGGLE:SIG_OFF]</span> vs ON (level-match). <span class="ref">[REF:R3-05]</span> <span class="ref">[REF:R3-02]</span></li>
        <li><b>Dry doit tenir</b> : si la lead ‚Äútombe‚Äù quand SIG OFF, le probl√®me est ailleurs ‚Üí rollback Phase 2. <span class="ref">[REF:R3-11]</span> <span class="ref">[REF:R3-03]</span></li>
        <li><b>Routing-first</b> : d√©clare o√π vit l‚Äôespace (1‚Äì2 returns fixes + throws) avant de toucher les r√©glages. <span class="ref">[REF:R3-13]</span></li>
      </ul>

      <div class="hr"></div>

      <table>
        <tr><th style="width:220px;">Champ</th><th>Valeur</th></tr>

        <tr>
          <td><b>PATH_COMMIT</b></td>
          <td>
            <input class="fill" placeholder="auto-rempli au COMMIT (ex: Plate luxe)" data-bind="core.pathCommit" readonly>
            <div class="hr"></div>
            <div style="display:grid;grid-template-columns: 1fr 1fr; gap:10px;">
              <div><b>CROIX</b><input class="fill" placeholder="auto-rempli" data-bind="core.croix" readonly></div>
              <div><b>RISK_FOCUS</b><input class="fill" placeholder="auto-rempli" data-bind="core.riskFocus" readonly></div>
            </div>
          </td>
        </tr>

        <tr>
          <td><b>TARGET_PRIMARY</b></td>
          <td><input class="fill" placeholder="auto-rempli (ex: RETURNS)" data-bind="core.targetPrimary" readonly></td>
        </tr>

        <tr>
          <td><b>TARGET_SECONDARY</b></td>
          <td><input class="fill" placeholder='auto-rempli ("Aucun" si vide)' data-bind="core.targetSecondary" readonly></td>
        </tr>

        <tr>
          <td><b>SCAN</b></td>
          <td class="muted">plan avant/arri√®re ‚Üí consonnes ‚Üí fins de phrases ‚Üí mono ‚Üí groove (1 intention √† la fois).</td>
        </tr>

        <tr>
          <td><b>CONSTATS</b></td>
          <td><input class="fill" placeholder="1 phrase avant correction ‚Üí NOTES‚ÄîPorte (ou NOTES‚ÄîOREILLE_NEUVE)" data-bind="core.constats"></td>
        </tr>
      </table>

      <div class="hr"></div>

      <div class="muted">
        <b>Ressources rapides</b> (ouvre dans un drawer) :
        <div style="display:flex;flex-wrap:wrap;gap:8px;margin-top:8px;">
          <button class="btn" data-open-resource="p13-redflags">3) RED FLAGS</button>
          <button class="btn" data-open-resource="p13-sigfail">4) SYMPT√îMES SIGNATURE</button>
          <button class="btn" data-open-resource="p13-soclefail">5) SYMPT√îMES SOCLE</button>
          <button class="btn" data-open-resource="p13-listen">6) LISTEN</button>
          <button class="btn" data-open-resource="p13-techpack">7) TECH PACK</button>
          <button class="btn" data-open-resource="p13-busmap">8) BUSMAP</button>
          <button class="btn" data-open-resource="p13-modules">9) MINI-MODULES</button>
          <button class="btn" data-open-resource="p13-checkpoints">11) CHECKPOINTS</button>
        </div>
      </div>

      <div class="hr"></div>

      <div class="stop"><b>STOP</b> : si ‚Äúmieux‚Äù seulement parce que plus fort ‚Üí level-match ‚Üí re-d√©cide, sinon refuse. <span class="ref">[REF:R3-05]</span></div>
      <div class="stop"><b>STOP</b> : si la lead recule ‚Üí baisse l‚Äôespace (un levier) ‚Üí re-test. <span class="ref">[REF:R3-04]</span></div>
      <div class="stop"><b>STOP</b> : si la diction se noie ‚Üí espace doit se retirer pendant la phrase (un levier) ‚Üí re-test. <span class="ref">[REF:R3-10]</span></div>
      <div class="stop"><b>STOP</b> : si mono rend le centre instable/creux ‚Üí resserre ou remplace l‚Äôespace ‚Üí re-test. <span class="ref">[REF:R3-04]</span></div>
      <div class="stop"><b>STOP</b> : si l‚Äô√©cho casse le flow ‚Üí simplifie ou retire ‚Üí re-test. <span class="ref">[REF:R3-10]</span></div>
    </div>
  </section>

  <!-- TESTS -->
  <section class="card" data-section-id="tests">
    <header>
      <div class="h">
        <span class="tag">2) [TEST:ALWAYS]</span>
        <span>Table PASS / FAIL / SKIP</span>
      </div>
      <div class="sub">SIG_OFF vs ON = non-skippable pour DONE</div>
    </header>

    <div class="body">
      <div data-mount="tests-table"></div>

      <div class="hr"></div>
      <div class="muted">
        <b>R√®gles</b>
        <ul>
          <li>PASS partout ‚Üí ne rien ouvrir ‚Üí HANDOFF + JOURNAL ‚Üí porte suivante.</li>
          <li>Si SIG OFF vs ON est SKIP ‚Üí porte ‚â† DONE.</li>
          <li>Si PATH_COMMIT valid√© = SKIP ‚Üí porte ‚â† DONE.</li>
          <li>Si supports requis et tous SKIP/vides ‚Üí porte ‚â† DONE.</li>
        </ul>
      </div>
    </div>
  </section>

  <!-- HANDOFF -->
  <section class="card" data-section-id="handoff">
    <header>
      <div class="h">
        <span class="tag">12) HANDOFF</span>
        <span>Sortie (3 lignes max)</span>
      </div>
      <div class="sub">Ce que tu g√®les si PASS</div>
    </header>

    <div class="body">
      <ul>
        <li><b>ON/OFF</b> : monde d‚Äôespace d√©clar√© ; returns contr√¥lables ; SIG OFF = preuve. <span class="ref">[REF:R3-02]</span></li>
        <li><b>RISK_BADGE + trigger</b> (si fragile) :
          <input class="fill" placeholder="______" data-bind="handoff.riskBadge"> ;
          r√©ouvrir seulement sur FAIL prouv√©. <span class="ref">[REF:R3-18]</span>
        </li>
        <li><b>Next door</b> : <span class="tag" data-bind="handoff.nextDoor"></span> ‚Äî Largeur / couches / architecture.</li>
      </ul>
    </div>
  </section>

  <!-- NOTES -->
  <section class="card" data-section-id="notes">
    <header>
      <div class="h">
        <span class="tag">13) NOTES</span>
        <span>Porte (SCOPE=door)</span>
      </div>
      <div class="sub">2 TRIAL + 1 CONSTATS (1 phrase)</div>
    </header>

    <div class="body">
      <table>
        <tr><th style="width:200px;">Champ</th><th>Texte</th></tr>
        <tr><td>TRIAL</td><td><input class="fill" placeholder="+apport / -casse (1 phrase)" data-bind="notes.trials.0"></td></tr>
        <tr><td>TRIAL</td><td><input class="fill" placeholder="+apport / -casse (1 phrase)" data-bind="notes.trials.1"></td></tr>
        <tr><td>CONSTATS</td><td><input class="fill" placeholder="1 phrase" data-bind="notes.constats"></td></tr>
        <tr><td>OREILLE_NEUVE</td><td><input class="fill" placeholder="si d√©clench√©e: note courte" data-bind="notes.oreilleNeuve"></td></tr>
        <tr><td>Apr√®s COMMIT</td><td class="muted">Chaque correction r√©f√©rence RISK_FOCUS ou CROIX (sinon FAIL).</td></tr>
      </table>
    </div>
  </section>

  <!-- JOURNAL -->
  <section class="card" data-section-id="journal">
    <header>
      <div class="h">
        <span class="tag">14) JOURNAL</span>
        <span>1 ligne minimum</span>
      </div>
      <div class="sub">Trace l‚Äôaction (1 levier) + r√©sultat</div>
    </header>

    <div class="body">
      <table>
        <tr>
          <th>Date</th>
          <th>Porte</th>
          <th>PATH_COMMIT</th>
          <th>TARGET_PRIMARY</th>
          <th>Action</th>
          <th>R√©sultat</th>
          <th>NEEDS_RETEST</th>
          <th>RISK_BADGE</th>
        </tr>
        <tr>
          <td><input class="fill" placeholder="YYYY-MM-DD" data-bind="journalDraft.date"></td>
          <td>P13</td>
          <td><input class="fill" placeholder="auto" data-bind="core.pathCommit" readonly></td>
          <td><input class="fill" placeholder="auto" data-bind="core.targetPrimary" readonly></td>
          <td><input class="fill" placeholder="1 levier" data-bind="journalDraft.action"></td>
          <td><input class="fill" placeholder="PASS/FAIL" data-bind="journalDraft.result"></td>
          <td><input class="fill" placeholder="oui/non" data-bind="journalDraft.needsRetest"></td>
          <td><input class="fill" placeholder="..." data-bind="journalDraft.riskBadge"></td>
        </tr>
      </table>
    </div>
  </section>
</div>
